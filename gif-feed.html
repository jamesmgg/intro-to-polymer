<link rel="import" href="bower_components/polymer/polymer.html">

<dom-module id="gif-feed">
    <style>
        img {
            display:inline-block;
        }
    </style>

    <template>
        <template is="dom-repeat" items="{{gifns}}">
            <img src="{{item.images.downsized_large.url}}" />
        </template>
    </template>

    <script>
        Polymer({
            is: "gif-feed",
            properties: {
              baseUrl: {
                  type: String,
                  value: 'http://api.giphy.com/v1/gifs/search?api_key=dc6zaTOxFJmzC&q='
              }
            },
            observers: [
                "observeQuery(query)"
            ],
            ready: function () {
                this.grabGifs()
            },
            observeQuery: function () {
                this.debounce('grabGifs', this.grabGifs, 300)
            },
            grabGifs: function() {
                console.log("grabbing gifs!")
                var self = this;
                var xhr = new XMLHttpRequest();

                self.set("gifns", [])
                
                // Send an ajax request to get the gif data
                xhr.open('GET', this.baseUrl + this.query);
                xhr.send();
                xhr.onreadystatechange = function() {
                    if(xhr.readyState == 4 && xhr.status == 200){
                        var gifns = [];
                        var response = JSON.parse(xhr.responseText);

                        self.set("gifns", response.data)
                    }
                }
            }
        });
    </script>
</dom-module>